[supervisord]
nodaemon=true
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid

[program:backend]
command=bash /app/start_backend.sh
directory=/app
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
priority=200
environment=PYTHONUNBUFFERED=1,OPENAI_BASE_URL="http://localhost:8000/v1"

[program:nextjs]
command=npm start
directory=/app/demos/frontend
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=NODE_ENV=production,PORT=3000

[program:nginx]
command=bash -c "/app/wait-for-all-services.sh && exec /usr/sbin/nginx -g 'daemon off;'"
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
priority=999